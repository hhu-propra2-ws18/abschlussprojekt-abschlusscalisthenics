<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LeihOrDie!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
      <script th:inline="javascript">
          function sendLoanRequest() {
              /*<![CDATA[*/
              var url = /*[[@{|http://localhost:8080/request/${id}|}]]*/ "request/";
              /*]]>*/
              var loanDuration = document.getElementById("loanDuration").value;
              var xhr = new XMLHttpRequest();
              xhr.open("POST", url, true);
              xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

              xhr.send("loanDuration=" + loanDuration);
              xhr.onreadystatechange = function() {
                  if(xhr.readyState === 4 && xhr.responseURL == "http://localhost:8080/login") {
                      location.href = "http://localhost:8080/login";
                  } else if (xhr.readyState === 4 && xhr.status == 200) {
                      document.getElementById("modal-text").innerHTML = "Ihre Anfrage wurde erfolgreich übermittelt.\n" +
                          "Sie werden über die Entscheidung des Verleihers in Kürze informiert.";
                      document.getElementById("modal-text").style.color = "green";
                      document.getElementById("loanForm").innerHTML;
                      document.getElementById("loanForm").innerHTML="<p style='color:green; font-size:20px'>Anfrage erfolgreich!</p>";
                      modal.style.display = "block";
                  } else if(xhr.readyState === 4 && xhr.status != 200) {
                      document.getElementById("modal-text").innerHTML = "Es gab einen Fehler beim Ausführen Ihrer Anfrage:\n" +
                          xhr.response;
                      document.getElementById("modal-text").style.color = "red";
                      modal.style.display = "block";
                  }
              };
          };
      </script>
      <style>
          .modal {
              display: none;
              font-size: 25px;
              position: fixed;
              z-index: 1;
              padding-top: 100px;
              left: 0;
              top: 0;
              width: 100%;
              height: 100%;
              overflow: auto;
              background-color: rgb(0,0,0);
              background-color: rgba(0,0,0,0.4);
          }

          .modal-content {
              background-color: #fefefe;
              margin: auto;
              padding: 20px;
              border: 1px solid #888;
              width: 80%;
          }

          .close {
              color: #aaaaaa;
              float: right;
              font-size: 28px;
              font-weight: bold;
          }

          .close:hover,
          .close:focus {
              color: #000;
              text-decoration: none;
              cursor: pointer;
          }
      </style>
  </head>
  <body th:href="@{|/borrowall/{id}|}">
  <div th:insert="fragments/header :: header"></div>
      <section class="hero is-fullheight is-default is-bold">
       <div class="hero-body">
           <div class="container has-text-left">
               <h1 th:text="${name}" class="title is-bold has-text-centered"  > Artikelname </h1>
               <br></br>
               <div class="columns is-vcentered">

                   <div class="container">
                       <div id="myCarousel" class="carousel slide" data-ride="carousel">

                           <!-- Indicators-->
                           <ol class="carousel-indicators">
                               <th:block th:each="num : ${numOfPictures}">
                                   <li data-target="#myCarousel" th:attr="data-slide-to=${num}" class=""></li>
                               </th:block>
                           </ol>

                           <!--
                          <ol class="carousel-indicators">
                              <li data-target="#myCarousel" th:attr="data-slide-to=0" class="active'"></li>
                              <li data-target="#myCarousel" th:attr="data-slide-to=1"></li>
                          </ol>-->

                           <!-- Wrapper for slides-->
                           <div class="carousel-inner">
                               <div th:each= "picture : ${pictures}" class="item active">
                                   <img th:src="${picture}" alt="cats" style="width:100%;">
                               </div>
                           </div>

                           <!-- Left and right controls -->
                           <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                               <span class="glyphicon glyphicon-chevron-left"></span>
                               <span class="sr-only">Previous</span>
                           </a>
                           <a class="right carousel-control" href="#myCarousel" data-slide="next">
                               <span class="glyphicon glyphicon-chevron-right"></span>
                               <span class="sr-only">Next</span>
                           </a>
                       </div>
                   </div>

                   <div id="myModal" class="modal">
                       <div class="modal-content">
                           <span class="close">&times;</span>
                           <p id="modal-text">Some text in the Modal..</p>
                       </div>

                   </div>

                   <div class="column is-6 is-offset-1">
                     <p class="has-text-right">
                       
                       <h1 th:text="${name}" class="title is-2"> ArtikelName </h1>

                     </p>
                       <h2 th:text="'Beschreibung: ' + ${description}" class="subtitle is-4">
                           Beschreibung:

                       </h2>
                       <h3 th:text="'Abholort: ' + ${location}" class="subtitle is-4">
                           Abholort:

                       </h3>
                       <h4 th:text="'Verfügbarkeit: ' + ${availableTime}" class="subtitle is-4">
                           Verfügbarkeit:

                       </h4>
                       <h5 th:text="'Kaution: ' + ${deposit} + '€' " class="subtitle is-4">
                           Kaution (€):

                       </h5>
                       <h6 th:text="'Preis pro Tag: ' + ${cost} + '€'" class="subtitle is-4">
                           Preis pro Tag (€):

                       </h6>
                       <h7 th:text="'Anbieter: ' + ${username}" class="subtitle is-4">
                           Ausleiher:


                       </h7>
                       <br>

                       <div id="loanForm">
                           <div th:if="${isAvailable} == true">
                               <form th:object="${LoanForm}">
                                   <div class="field">
                                       <label class="label">Wie viel Tagen:</label>
                                       <div class="control">
                                           <input class="input" id="loanDuration" type="number" pattern="\d*" placeholder="Wie lange am Stück willst du deinen Artikel ausleihen?" th:field="*{loanDuration}">
                                       </div>
                                       <p class="help is-danger" th:if="${#fields.hasErrors('loanDuration')}" th:errors="*{loanDuration}">Falsch eingegeben</p>
                                   </div>
                               </form>
                               <div class="field is-grouped">
                                   <div class="control">
                                       <button class="button is-block is-primary is-normal " id="loanBtn">Anfragen</button>
                                   </div>
                               </div>
                           </div>

                           <div th:if="${isAvailable} == false">
                               <p>Dieser Artikel ist gerade nicht verfügbar.</p>
                           </div>
                       </div>

                       <br>
                       <p class="has-text-right">
                           <a  th:href="@{'/borrowall'}" class="button is-medium is-primary is-outlined">zurück</a>
                       </p>
                       <br>
                   </div>
               </div>
           </div>
       </div>
   </section>
  <script>
      var modal = document.getElementById('myModal');
      var btn = document.getElementById("loanBtn");
      var span = document.getElementsByClassName("close")[0];

      btn.onclick = function() {
          sendLoanRequest();
      };

      span.onclick = function() {
          modal.style.display = "none";
      };

      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
      };
  </script>
  </body>
</html>
